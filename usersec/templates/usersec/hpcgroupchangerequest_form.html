{% extends 'base.html' %}

{% load crispy_forms_tags %}
{% load common %}

{% block content %}

  <h2 class="mt-5">
    {% if update %}
      {% if admin %}
        Request Revision
      {% else %}
        Update Group Request
      {% endif %}
    {% else %}
      Change Group Request
    {% endif %}
  </h2>

  {% include "usersec/modules/comments.html" %}

  <form method="post" class="mt-3 mb-3" id="submit" data-is-admin="{{ admin }}">
    {% csrf_token %}
    {% if admin %}
      <dl class="row">
        {% include "usersec/modules/resources_requested.html" with object=object %}

        <dt class="col-sm-6">Requester</dt>
        <dd class="col-sm-6">{{ object.requester.username }}</dd>

        <dt class="col-sm-6">Description</dt>
        <dd class="col-sm-6">{{ object.description }}</dd>

        <dt class="col-sm-6">Expiration</dt>
        <dd class="col-sm-6">{{ object.expiration|date:"Y-m-d" }}</dd>
      </dl>
    {% endif %}

    {% for field in form.hidden_fields %}
      {{ field }}
    {% endfor %}

    {% if admin %}
    <div class="d-none">
    {% endif %}

    {% include "usersec/form_field.html" with field=form.description %}
    {% include "usersec/form_field.html" with field=form.delegate %}
    {% include "usersec/form_field.html" with field=form.expiration %}

    <h4 class="mt-4">Resources</h4>

    <div class="row mt-3">
      <div class="col-md-6">
        <h5>Tier 1</h5>
        {% include "usersec/form_field.html" with field=form.tier1_scratch %}
      </div>
      <div class="col-md-6">
        <h5>Tier 2</h5>
        {% include "usersec/form_field.html" with field=form.tier2_unmirrored %}
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        {% include "usersec/form_field.html" with field=form.tier1_work %}
      </div>
      <div class="col-md-6">
        {% include "usersec/form_field.html" with field=form.tier2_mirrored %}
      </div>
    </div>

    {% if admin %}
    </div>
    {% endif %}

    {% include "usersec/form_field.html" with field=form.comment %}

    <a class="btn btn-secondary" href="{% url 'home' %}">
      Cancel
    </a>
    <button class="btn btn-primary" type="submit" id="id_submit_button">
      {% if update %}
        {% if admin %}
          Request Revision
        {% else %}
          Update
        {% endif %}
      {% else %}
        Submit
      {% endif %}
    </button>
  </form>
{% endblock content %}

{% block inline_javascript %}
  {{ block.super }}
  <script>
    $(document).ready(function() {
      $(".mergeToJson").change(mergeToJson);

      jsonToFields();

      $("#submit").submit(function(event) {
        if (!$(this).data("is-admin")) {
          mergeToJson();
        }
      });
    });
  </script>
{% endblock inline_javascript %}
